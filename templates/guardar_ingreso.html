<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Guardar Ingreso</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">

    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalIngreso">
        + Nuevo Ingreso
    </button>

</div>

<!-- ===== MODAL ===== -->
<div class="modal fade" id="modalIngreso" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">

            <form id="formIngreso">
                {% csrf_token %}

                <div class="modal-header">
                    <h5 class="modal-title">Registrar Ingreso</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <div class="mb-3">
                        <label class="form-label">Fecha *</label>
                        <input type="date" name="fecha" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Descripción *</label>
                        <input type="text" name="descripcion" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Renta</label>
                        <input type="number" step="0.01" name="renta" class="form-control">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Pagos</label>
                        <input type="number" step="0.01" name="pagos" class="form-control">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Pestaña destino *</label>
                        <input type="text" name="pestana" class="form-control"
                               placeholder="Ej: ENERO.2025" required>
                    </div>

                    <div id="mensaje" class="alert d-none"></div>

                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">
                        Guardar
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Cancelar
                    </button>
                </div>

            </form>

        </div>
    </div>
</div>

<!-- Bootstrap + JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.getElementById("formIngreso").addEventListener("submit", function(e) {
    e.preventDefault();

    const form = this;
    const mensaje = document.getElementById("mensaje");
    const formData = new FormData(form);

    fetch("{% url 'tupac_amaru:guardar_ingreso' %}", {
        method: "POST",
        body: formData,
        headers: {
            "X-CSRFToken": formData.get("csrfmiddlewaretoken")
        }
    })
    .then(res => res.json())
    .then(data => {
        mensaje.classList.remove("d-none", "alert-danger", "alert-success");

        if (data.status === "success") {
            mensaje.classList.add("alert-success");
            mensaje.innerText = data.message;
            form.reset();
        } else {
            mensaje.classList.add("alert-danger");
            mensaje.innerText = data.message;
        }
    })
    .catch(() => {
        mensaje.classList.remove("d-none");
        mensaje.classList.add("alert-danger");
        mensaje.innerText = "Error al guardar";
    });
});
</script>

</body>
</html>
